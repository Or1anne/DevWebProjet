{% extends "base.html" %}

{% block content %}

<!-- Barre de recherche -->
<div class="search-container">
    {% if not current_user.is_authenticated %}
    <input type="text" class="search-input search-news" placeholder="Rechercher une actualit√©...">
    {% endif %}
    {% if current_user.is_authenticated %}
    <input type="text" class="search-input search-obj" placeholder="Rechercher un objet...">
    {% endif %}
    <button class="search-button">Rechercher</button>
</div>

<h1 class="title">
    Bienvenue {{current_user.firstname}} ! 
</h1>

<!-- Conteneur des actualit√©s et informations -->
<div class="content-container">
    <!-- Actualit√©s -->
    <div class="box-index news-box">
        <h2 class="title-box">Membres de la famille</h2>
        <!-- <div class="news-item">
            <h3>Nouvelle r√©forme √©conomique</h3>
            <p>Le gouvernement annonce une nouvelle r√©forme pour soutenir les petites entreprises, dans le but de favoriser leur croissance et de renforcer leur comp√©titivit√© sur le march√©. Cette r√©forme comprend des mesures de simplification administrative, un all√©gement fiscal, ainsi qu'un soutien renforc√© √† l'innovation et √† la transition num√©rique. L'objectif est de permettre aux petites entreprises d'acc√©der plus facilement aux financements et de stimuler leur d√©veloppement, tout en leur offrant un cadre plus flexible et adapt√© √† leurs besoins. En renfor√ßant ces acteurs √©conomiques cl√©s, le gouvernement esp√®re √©galement cr√©er de nouveaux emplois et dynamiser l'√©conomie locale.</p>
        </div> -->
        <div class="user-box">
            {% for user in users %}
                {% if user.id != current_user.id %}
                <div class="news-item">
                    <h3>{{ user.pseudo }}</h3>
                    {% if user.image %}
                        <img class="pp" src="data:image/png;base64,{{ user.image | b64encode }}" width="60" height="60">
                    {% else %}
                        <img src="{{ url_for('static', filename='utilisateur-de-profil-sans-fond.png') }}"  width="60" height="60">
                    {% endif %}
                    <p><strong>√Çge :</strong> {{ user.age }} ans</p>
                    <p><strong>Genre :</strong> {{ user.gender }}</p>
                    <p><strong>Date de Naissance :</strong> {{ user.birthdate.strftime('%d-%m-%Y')}}</p>
                    <p><strong>R√¥le :</strong> {{ user.role }}</p>
                    <p><strong>Niveau :</strong> {{ user.level }}</p>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Informations locales -->
    <!-- TODO √† changer -->
    <div class="box-index info-box">
        <h2 class="title-box">üìç Informations Locales</h2>
        <div class="info-item">
            <h3>Travaux sur la ligne de m√©tro</h3>
            <p>Le m√©tro ligne 3 sera en travaux du 10 au 15 mars, avec des bus de substitution</p>
        </div>
        <div class="info-item">
            <h3>March√© local ce weekend</h3>
            <p>Retrouvez les producteurs locaux sur la place centrale ce samedi matin !</p>
        </div>
        <div class="info-item">
            
                <!-- Section M√©t√©o -->
        
            <h2 class="title-box">M√©t√©o √† Cergy</h2>
            <div id="weather-info" class="weather-info">
                <p>Chargement...</p>
            </div>
        
 
     
    <script>
    // Fonction pour r√©cup√©rer la m√©t√©o
    const API_KEY = '47e393553f924e66b8a171010250704'; // Remplace par ta cl√© API
    const city = 'Cergy'; // Nom de la ville
     
    const fetchWeather = async () => {
        const weatherContainer = document.getElementById('weather-info');
        try {
            const response = await fetch(`https://api.weatherapi.com/v1/forecast.json?key=${API_KEY}&q=${city}&days=4&lang=fr`);
            if (!response.ok) throw new Error('Erreur lors de la r√©cup√©ration de la m√©t√©o');
            const data = await response.json();
     
            const weather = data.current;
            const forecast = data.forecast.forecastday;
     
            // Construire le contenu m√©t√©o
            const iconUrl = `https://${weather.condition.icon}`;
     
            const weatherHTML = `
                <div class="weather-details">
                    <img src="${iconUrl}" alt="${weather.condition.text}" width="80" height="80">
                    <div>
                        <p><strong>Condition : </strong>${weather.condition.text}</p>
                        <p><strong>Temp√©rature actuelle : </strong>${Math.round(weather.temp_c)}¬∞C</p>
                    </div>
                </div>            
            `;
     
            weatherContainer.innerHTML = weatherHTML;
        } catch (error) {
            weatherContainer.innerHTML = `<p style="color: red;">Erreur : ${error.message}</p>`;
        }
    };
     
    // Charger la m√©t√©o au chargement de la page
    window.onload = fetchWeather;
    </script>
            </div>
        {% if current_user.level == "Avance" or current_user.level == "Expert" %}
            <button class="button is-info">Ajouter une information</button>
        {% endif %}
    </div>
</div>
{% endblock %}
